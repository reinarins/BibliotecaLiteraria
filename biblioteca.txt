"IF NOT EXISTS (SELECT 1 FROM [Libros] WHERE [T√≠tulo] = @T√≠tulo AND [Autor] = @Autor)
    INSERT INTO [Libros]([T√≠tulo], [Autor], [Editorial], [Categor√≠a], [Publicaci√≥n]) 
    VALUES(@T√≠tulo, @Autor, @Editorial, @Categor√≠a, @Publicaci√≥n);"



"SELECT 
    L.[T√≠tulo],
    L.[Autor],
    L.[Categor√≠a],
    COUNT(P.idLibro) AS CantidadDePr√©stamos
FROM Prestamos P
INNER JOIN Libros L ON L.id = P.idLibro
GROUP BY 
    L.[T√≠tulo],
    L.[Autor],
    L.[Categor√≠a]
ORDER BY CantidadDePr√©stamos DESC;"


UPDATE Pr√©stamos
GO
-- üî∏ 1. La bestia - Carmen Mola
IF NOT EXISTS (SELECT 1 FROM Libros WHERE T√≠tulo = 'La bestia' AND Autor = 'Carmen Mola')
INSERT INTO Libros (T√≠tulo, Autor, Editorial, Categor√≠a, Publicaci√≥n)
VALUES ('La bestia', 'Carmen Mola', 'Editorial Planeta', 'Misterio y suspense', 2021);
DECLARE @id1 INT = (SELECT id FROM Libros WHERE T√≠tulo = 'La bestia' AND Autor = 'Carmen Mola');
DECLARE @i1 INT = 1;
WHILE @i1 <= 964
BEGIN
    INSERT INTO Pr√©stamos (idLibro, FechaPr√©stamo)
    VALUES (@id1, DATEFROMPARTS(2022, ABS(CHECKSUM(NEWID())) % 12 + 1, ABS(CHECKSUM(NEWID())) % 28 + 1));
    SET @i1 += 1;
END;

-- üî∏ 2. De ninguna parte - Julia Navarro
IF NOT EXISTS (SELECT 1 FROM Libros WHERE T√≠tulo = 'De ninguna parte' AND Autor = 'Julia Navarro')
INSERT INTO Libros (T√≠tulo, Autor, Editorial, Categor√≠a, Publicaci√≥n)
VALUES ('De ninguna parte', 'Julia Navarro', 'Plaza & Jan√©s', 'Narrativa contempor√°nea', 2021);
DECLARE @id2 INT = (SELECT id FROM Libros WHERE T√≠tulo = 'De ninguna parte' AND Autor = 'Julia Navarro');
DECLARE @i2 INT = 1;
WHILE @i2 <= 875
BEGIN
    INSERT INTO Pr√©stamos (idLibro, FechaPr√©stamo)
    VALUES (@id2, DATEFROMPARTS(2022, ABS(CHECKSUM(NEWID())) % 12 + 1, ABS(CHECKSUM(NEWID())) % 28 + 1));
    SET @i2 += 1;
END;

-- üî∏ 3. √öltimos d√≠as en Berl√≠n - Paloma S√°nchez-Garnica
IF NOT EXISTS (SELECT 1 FROM Libros WHERE T√≠tulo = '√öltimos d√≠as en Berl√≠n' AND Autor = 'Paloma S√°nchez-Garnica')
INSERT INTO Libros (T√≠tulo, Autor, Editorial, Categor√≠a, Publicaci√≥n)
VALUES ('√öltimos d√≠as en Berl√≠n', 'Paloma S√°nchez-Garnica', 'Editorial Planeta', 'Narrativa contempor√°nea', 2021);
DECLARE @id3 INT = (SELECT id FROM Libros WHERE T√≠tulo = '√öltimos d√≠as en Berl√≠n' AND Autor = 'Paloma S√°nchez-Garnica');
DECLARE @i3 INT = 1;
WHILE @i3 <= 867
BEGIN
    INSERT INTO Pr√©stamos (idLibro, FechaPr√©stamo)
    VALUES (@id3, DATEFROMPARTS(2022, ABS(CHECKSUM(NEWID())) % 12 + 1, ABS(CHECKSUM(NEWID())) % 28 + 1));
    SET @i3 += 1;[PK__Prestamo__3213E83F684DDAA9]
END;

-- üî∏ 4. Violeta - Isabel Allende
IF NOT EXISTS (SELECT 1 FROM Libros WHERE T√≠tulo = 'Violeta' AND Autor = 'Isabel Allende')
INSERT INTO Libros (T√≠tulo, Autor, Editorial, Categor√≠a, Publicaci√≥n)
VALUES ('Violeta', 'Isabel Allende', 'Plaza & Jan√©s', 'Narrativa contempor√°nea', 2022);
DECLARE @id4 INT = (SELECT id FROM Libros WHERE T√≠tulo = 'Violeta' AND Autor = 'Isabel Allende');
DECLARE @i4 INT = 1;
WHILE @i4 <= 774
BEGIN
    INSERT INTO Pr√©stamos (idLibro, FechaPr√©stamo)
    VALUES (@id4, DATEFROMPARTS(2022, ABS(CHECKSUM(NEWID())) % 12 + 1, ABS(CHECKSUM(NEWID())) % 28 + 1));
    SET @i4 += 1;
END;

-- üî∏ 5. El libro negro de las horas - Eva Garc√≠a S√°enz de Urturi
IF NOT EXISTS (SELECT 1 FROM Libros WHERE T√≠tulo = 'El libro negro de las horas' AND Autor = 'Eva Garc√≠a S√°enz de Urturi')
INSERT INTO Libros (T√≠tulo, Autor, Editorial, Categor√≠a, Publicaci√≥n)
VALUES ('El libro negro de las horas', 'Eva Garc√≠a S√°enz de Urturi', 'Editorial Planeta', 'Misterio y suspense', 2022);
DECLARE @id5 INT = (SELECT id FROM Libros WHERE T√≠tulo = 'El libro negro de las horas' AND Autor = 'Eva Garc√≠a S√°enz de Urturi');
DECLARE @i5 INT = 1;
WHILE @i5 <= 743
BEGIN
    INSERT INTO Pr√©stamos (idLibro, FechaPr√©stamo)
    VALUES (@id5, DATEFROMPARTS(2022, ABS(CHECKSUM(NEWID())) % 12 + 1, ABS(CHECKSUM(NEWID())) % 28 + 1));
    SET @i5 += 1;
END;

-- üî∏ 6. El italiano - Arturo P√©rez-Reverte
IF NOT EXISTS (SELECT 1 FROM Libros WHERE T√≠tulo = 'El italiano' AND Autor = 'Arturo P√©rez-Reverte')
INSERT INTO Libros (T√≠tulo, Autor, Editorial, Categor√≠a, Publicaci√≥n)
VALUES ('El italiano', 'Arturo P√©rez-Reverte', 'Alfaguara', 'Narrativa hist√≥rica', 2021);
DECLARE @id6 INT = (SELECT id FROM Libros WHERE T√≠tulo = 'El italiano' AND Autor = 'Arturo P√©rez-Reverte');
DECLARE @i6 INT = 1;
WHILE @i6 <= 702
BEGIN
    INSERT INTO Pr√©stamos (idLibro, FechaPr√©stamo)
    VALUES (@id6, DATEFROMPARTS(2022, ABS(CHECKSUM(NEWID())) % 12 + 1, ABS(CHECKSUM(NEWID())) % 28 + 1));
    SET @i6 += 1;
END;

-- üî∏ 7. La novia gitana - Carmen Mola
IF NOT EXISTS (SELECT 1 FROM Libros WHERE T√≠tulo = 'La novia gitana' AND Autor = 'Carmen Mola')
INSERT INTO Libros (T√≠tulo, Autor, Editorial, Categor√≠a, Publicaci√≥n)
VALUES ('La novia gitana', 'Carmen Mola', 'Alfaguara', 'Misterio y suspense', 2018);
DECLARE @id7 INT = (SELECT id FROM Libros WHERE T√≠tulo = 'La novia gitana' AND Autor = 'Carmen Mola');
DECLARE @i7 INT = 1;
WHILE @i7 <= 634
BEGIN
    INSERT INTO Pr√©stamos (idLibro, FechaPr√©stamo)
    VALUES (@id7, DATEFROMPARTS(2022, ABS(CHECKSUM(NEWID())) % 12 + 1, ABS(CHECKSUM(NEWID())) % 28 + 1));
    SET @i7 += 1;
END;

-- üî∏ 8. El mentiroso - Mikel Santiago
IF NOT EXISTS (SELECT 1 FROM Libros WHERE T√≠tulo = 'El mentiroso' AND Autor = 'Mikel Santiago')
INSERT INTO Libros (T√≠tulo, Autor, Editorial, Categor√≠a, Publicaci√≥n)
VALUES ('El mentiroso', 'Mikel Santiago', 'Ediciones B', 'Misterio y suspense', 2020);
DECLARE @id8 INT = (SELECT id FROM Libros WHERE T√≠tulo = 'El mentiroso' AND Autor = 'Mikel Santiago');
DECLARE @i8 INT = 1;
WHILE @i8 <= 614
BEGIN
    INSERT INTO Pr√©stamos (idLibro, FechaPr√©stamo)
    VALUES (@id8, DATEFROMPARTS(2022, ABS(CHECKSUM(NEWID())) % 12 + 1, ABS(CHECKSUM(NEWID())) % 28 + 1));
    SET @i8 += 1;
END;

-- üî∏ 9. La chica italiana - Lucinda Riley
IF NOT EXISTS (SELECT 1 FROM Libros WHERE T√≠tulo = 'La chica italiana' AND Autor = 'Lucinda Riley')
INSERT INTO Libros (T√≠tulo, Autor, Editorial, Categor√≠a, Publicaci√≥n)
VALUES ('La chica italiana', 'Lucinda Riley', 'Plaza & Jan√©s', 'Narrativa rom√°ntica', 2021);
DECLARE @id9 INT = (SELECT id FROM Libros WHERE T√≠tulo = 'La chica italiana' AND Autor = 'Lucinda Riley');
DECLARE @i9 INT = 1;
WHILE @i9 <= 583
BEGIN
    INSERT INTO Pr√©stamos (idLibro, FechaPr√©stamo)
    VALUES (@id9, DATEFROMPARTS(2022, ABS(CHECKSUM(NEWID())) % 12 + 1, ABS(CHECKSUM(NEWID())) % 28 + 1));
    SET @i9 += 1;
END;

-- üî∏ 10. En plena noche - Mikel Santiago
IF NOT EXISTS (SELECT 1 FROM Libros WHERE T√≠tulo = 'En plena noche' AND Autor = 'Mikel Santiago')
INSERT INTO Libros (T√≠tulo, Autor, Editorial, Categor√≠a, Publicaci√≥n)
VALUES ('En plena noche', 'Mikel Santiago', 'Ediciones B', 'Misterio y suspense', 2021);
DECLARE @id10 INT = (SELECT id FROM Libros WHERE T√≠tulo = 'En plena noche' AND Autor = 'Mikel Santiago');
DECLARE @i10 INT = 1;
WHILE @i10 <= 548
BEGIN
    INSERT INTO Pr√©stamos (idLibro, FechaPr√©stamo)
    VALUES (@id10, DATEFROMPARTS(2022, ABS(CHECKSUM(NEWID())) % 12 + 1, ABS(CHECKSUM(NEWID())) % 28 + 1));
    SET @i10 += 1;
END;

-- üî∏ 11. Sira - Mar√≠a Due√±as
IF NOT EXISTS (SELECT 1 FROM Libros WHERE T√≠tulo = 'Sira' AND Autor = 'Mar√≠a Due√±as')
INSERT INTO Libros (T√≠tulo, Autor, Editorial, Categor√≠a, Publicaci√≥n)
VALUES ('Sira', 'Mar√≠a Due√±as', 'Editorial Planeta', 'Narrativa contempor√°nea', 2021);
DECLARE @id11 INT = (SELECT id FROM Libros WHERE T√≠tulo = 'Sira' AND Autor = 'Mar√≠a Due√±as');
DECLARE @i11 INT = 1;
WHILE @i11 <= 509
BEGIN
    INSERT INTO Pr√©stamos (idLibro, FechaPr√©stamo)
    VALUES (@id11, DATEFROMPARTS(2022, ABS(CHECKSUM(NEWID())) % 12 + 1, ABS(CHECKSUM(NEWID())) % 28 + 1));
    SET @i11 += 1;
END;

-- üî∏ 12. Lo que la marea esconde - Mar√≠a Oru√±a
IF NOT EXISTS (SELECT 1 FROM Libros WHERE T√≠tulo = 'Lo que la marea esconde' AND Autor = 'Mar√≠a Oru√±a')
INSERT INTO Libros (T√≠tulo, Autor, Editorial, Categor√≠a, Publicaci√≥n)
VALUES ('Lo que la marea esconde', 'Mar√≠a Oru√±a', 'Ediciones Destino', 'Misterio y suspense', 2021);
DECLARE @id12 INT = (SELECT id FROM Libros WHERE T√≠tulo = 'Lo que la marea esconde' AND Autor = 'Mar√≠a Oru√±a');
DECLARE @i12 INT = 1;
WHILE @i12 <= 461
BEGIN
    INSERT INTO Pr√©stamos (idLibro, FechaPr√©stamo)
    VALUES (@id12, DATEFROMPARTS(2022, ABS(CHECKSUM(NEWID())) % 12 + 1, ABS(CHECKSUM(NEWID())) % 28 + 1));
    SET @i12 += 1;
END;

-- üî∏ 13. Los vencejos - Fernando Aramburu
IF NOT EXISTS (SELECT 1 FROM Libros WHERE T√≠tulo = 'Los vencejos' AND Autor = 'Fernando Aramburu')
INSERT INTO Libros (T√≠tulo, Autor, Editorial, Categor√≠a, Publicaci√≥n)
VALUES ('Los vencejos', 'Fernando Aramburu', 'Tusquets Editores', 'Narrativa contempor√°nea', 2021);
DECLARE @id13 INT = (SELECT id FROM Libros WHERE T√≠tulo = 'Los vencejos' AND Autor = 'Fernando Aramburu');
DECLARE @i13 INT = 1;
WHILE @i13 <= 420
BEGIN
    INSERT INTO Pr√©stamos (idLibro, FechaPr√©stamo)
    VALUES (@id13, DATEFROMPARTS(2022, ABS(CHECKSUM(NEWID())) % 12 + 1, ABS(CHECKSUM(NEWID())) % 28 + 1));
    SET @i13 += 1;
END;

-- üî∏ 14. Una historia rid√≠cula - Luis Landero
IF NOT EXISTS (SELECT 1 FROM Libros WHERE T√≠tulo = 'Una historia rid√≠cula' AND Autor = 'Luis Landero')
INSERT INTO Libros (T√≠tulo, Autor, Editorial, Categor√≠a, Publicaci√≥n)
VALUES ('Una historia rid√≠cula', 'Luis Landero', 'Tusquets Editores', 'Narrativa rom√°ntica', 2022);
DECLARE @id14 INT = (SELECT id FROM Libros WHERE T√≠tulo = 'Una historia rid√≠cula' AND Autor = 'Luis Landero');
DECLARE @i14 INT = 1;
WHILE @i14 <= 392
BEGIN
    INSERT INTO Pr√©stamos (idLibro, FechaPr√©stamo)
    VALUES (@id14, DATEFROMPARTS(2022, ABS(CHECKSUM(NEWID())) % 12 + 1, ABS(CHECKSUM(NEWID())) % 28 + 1));
    SET @i14 += 1;
END;

-- üî∏ 15. Rey blanco - Juan G√≥mez-Jurado
IF NOT EXISTS (SELECT 1 FROM Libros WHERE T√≠tulo = 'Rey blanco' AND Autor = 'Juan G√≥mez-Jurado')
INSERT INTO Libros (T√≠tulo, Autor, Editorial, Categor√≠a, Publicaci√≥n)
VALUES ('Rey blanco', 'Juan G√≥mez-Jurado', 'Ediciones B', 'Misterio y suspense', 2020);
DECLARE @id15 INT = (SELECT id FROM Libros WHERE T√≠tulo = 'Rey blanco' AND Autor = 'Juan G√≥mez-Jurado');
DECLARE @i15 INT = 1;
WHILE @i15 <= 369
BEGIN
    INSERT INTO Pr√©stamos (idLibro, FechaPr√©stamo)
    VALUES (@id15, DATEFROMPARTS(2022, ABS(CHECKSUM(NEWID())) % 12 + 1, ABS(CHECKSUM(NEWID())) % 28 + 1));
    SET @i15 += 1;
END;

-- üî∏ 16. Un oc√©ano para llegar a ti - Sandra Barneda
IF NOT EXISTS (SELECT 1 FROM Libros WHERE T√≠tulo = 'Un oc√©ano para llegar a ti' AND Autor = 'Sandra Barneda')
INSERT INTO Libros (T√≠tulo, Autor, Editorial, Categor√≠a, Publicaci√≥n)
VALUES ('Un oc√©ano para llegar a ti', 'Sandra Barneda', 'Editorial Planeta', 'Narrativa contempor√°nea', 2020);
DECLARE @id16 INT = (SELECT id FROM Libros WHERE T√≠tulo = 'Un oc√©ano para llegar a ti' AND Autor = 'Sandra Barneda');
DECLARE @i16 INT = 1;
WHILE @i16 <= 311
BEGIN
    INSERT INTO Pr√©stamos (idLibro, FechaPr√©stamo)
    VALUES (@id16, DATEFROMPARTS(2022, ABS(CHECKSUM(NEWID())) % 12 + 1, ABS(CHECKSUM(NEWID())) % 28 + 1));
    SET @i16 += 1;
END;

-- üî∏ 17. Reina roja - Juan G√≥mez-Jurado
IF NOT EXISTS (SELECT 1 FROM Libros WHERE T√≠tulo = 'Reina roja' AND Autor = 'Juan G√≥mez-Jurado')
INSERT INTO Libros (T√≠tulo, Autor, Editorial, Categor√≠a, Publicaci√≥n)
VALUES ('Reina roja', 'Juan G√≥mez-Jurado', 'Ediciones B', 'Misterio y suspense', 2018);
DECLARE @id17 INT = (SELECT id FROM Libros WHERE T√≠tulo = 'Reina roja' AND Autor = 'Juan G√≥mez-Jurado');
DECLARE @i17 INT = 1;
WHILE @i17 <= 283
BEGIN
    INSERT INTO Pr√©stamos (idLibro, FechaPr√©stamo)
    VALUES (@id17, DATEFROMPARTS(2022, ABS(CHECKSUM(NEWID())) % 12 + 1, ABS(CHECKSUM(NEWID())) % 28 + 1));
    SET @i17 += 1;
END;

-- üî∏ 18. Pan de lim√≥n con semillas de amapola - Cristina Campos
IF NOT EXISTS (SELECT 1 FROM Libros WHERE T√≠tulo = 'Pan de lim√≥n con semillas de amapola' AND Autor = 'Cristina Campos')
INSERT INTO Libros (T√≠tulo, Autor, Editorial, Categor√≠a, Publicaci√≥n)
VALUES ('Pan de lim√≥n con semillas de amapola', 'Cristina Campos', 'Editorial Planeta', 'Narrativa contempor√°nea', 2021);
DECLARE @id18 INT = (SELECT id FROM Libros WHERE T√≠tulo = 'Pan de lim√≥n con semillas de amapola' AND Autor = 'Cristina Campos');
DECLARE @i18 INT = 1;
WHILE @i18 <= 247
BEGIN
    INSERT INTO Pr√©stamos (idLibro, FechaPr√©stamo)
    VALUES (@id18, DATEFROMPARTS(2022, ABS(CHECKSUM(NEWID())) % 12 + 1, ABS(CHECKSUM(NEWID())) % 28 + 1));
    SET @i18 += 1;
END;
